
ARG_initialize_immigration = {
	clear_array = ARG_immigration_countries
	add_to_array = { ARG_immigration_countries = SPR }
	set_variable = { argentine_migration@SPR = 3 }
	add_to_array = { ARG_immigration_countries = ITA }
	set_variable = { argentine_migration@ITA = 2 }
	ARG_reset_immigration_vars = yes
	ARG_reposition_immigration = yes
	ARG_update_migration = yes
}

ARG_reset_immigration_vars = {
	set_variable = { migration_multiplier_ba = 0.75 } # Buenos Aires
	set_variable = { migration_multiplier_er = 0.14 } # Mesopotamia
	set_variable = { migration_multiplier_me = 0.05 } # Mendoza
	set_variable = { migration_multiplier_tu = 0.03 } # Tucuman
	set_variable = { migration_multiplier_ca = 0.02 } # Chaco Austral
	set_variable = { migration_multiplier_pa = 0.01 } # Patagonia
}

ARG_reposition_immigration = {
	get_sorted_scored_countries = {
		scorer = argentine_immigration_scorer
		array = ARG_immigration_countries
	}
	set_variable = { ARG_next_country = ARG_immigration_countries^0 }
	set_temp_variable = { position = 0 }
	set_variable = { ARG_immigration_position = position }
	for_each_scope_loop = {
		array = ARG_immigration_countries
		
		add_to_temp_variable = { position = 1 }
		set_variable = { ARG_next_country = ARG.ARG_immigration_countries^position }
		set_variable = { ARG_immigration_position = position }
	}
}

ARG_update_migration = {
	set_variable = { total_migration = 0 }
	every_country = {
		limit = {
			NOT = { is_in_array = { ARG.ARG_immigration_countries = THIS } }
			capital_scope = { is_on_continent = europe }
		}

		if = {
			limit = { original_tag = SPR }

			add_to_array = { ARG.ARG_immigration_countries = THIS }
			set_variable = { ARG.argentine_migration@THIS = 3 }
		}
		else_if = {
			limit = { original_tag = SOV }

			add_to_array = { ARG.ARG_immigration_countries = THIS }
			set_variable = { ARG.argentine_migration@THIS = 0.033 }
		}
		else_if = {
			limit = { original_tag = FRA }

			add_to_array = { ARG.ARG_immigration_countries = THIS }
			set_variable = { ARG.argentine_migration@THIS = 0.01 }
		}
		else_if = {
			limit = { original_tag = ENG }

			add_to_array = { ARG.ARG_immigration_countries = THIS }
			set_variable = { ARG.argentine_migration@THIS = 0.033 }
		}
		else_if = {
			limit = { check_variable = { max_manpower_k < 13000 } }
			# Break
		}
		else_if = {
			add_to_array = { ARG.ARG_immigration_countries = THIS }
			set_variable = { ARG.argentine_migration@THIS = 0.1 }
		}
	}

	for_each_loop = {
		array = ARG_immigration_countries

		if = {
			limit = { NOT = { country_exists = v } }
			remove_from_array = { ARG_immigration_countries = v }
		}
	}
	for_each_scope_loop = {
		array = ARG_immigration_countries
		
		set_variable = { ARG_migration = ARG.argentine_migration@THIS }
		multiply_variable = { ARG_migration = max_manpower_k }
		divide_variable = { ARG_migration = 12 }

		if = {
			limit = { has_civil_war = yes }
			multiply_variable = { ARG_migration = 2 }
		}

		add_to_variable = { ARG.total_migration = ARG_migration }
	}
	
	set_variable = { total_migration_ba = migration_multiplier_ba } # Buenos Aires
	set_variable = { total_migration_er = migration_multiplier_er } # Mesopotamia
	set_variable = { total_migration_me = migration_multiplier_me } # Mendoza
	set_variable = { total_migration_tu = migration_multiplier_tu } # Tucuman
	set_variable = { total_migration_ca = migration_multiplier_ca } # Chaco Austral
	set_variable = { total_migration_pa = migration_multiplier_pa } # Patagonia

	multiply_variable = { total_migration_ba = total_migration }
	multiply_variable = { total_migration_er = total_migration }
	multiply_variable = { total_migration_me = total_migration }
	multiply_variable = { total_migration_tu = total_migration }
	multiply_variable = { total_migration_ca = total_migration }
	multiply_variable = { total_migration_pa = total_migration }

	278 = { add_manpower = var:total_migration_ba }
	510 = { add_manpower = var:total_migration_er }
	511 = { add_manpower = var:total_migration_me }
	508 = { add_manpower = var:total_migration_tu }
	509 = { add_manpower = var:total_migration_ca }
	512 = { add_manpower = var:total_migration_pa }
}

ARG_do_migration = {

}
